---
layout: post
title: "[리눅스시스템프로그래밍설계및실습] 2. 파일 입출력"
tags: LinuxSystemProgramming Spring2017
---

### 수강 정보

- 과목명 : 리눅스시스템프로그래밍설계및실습
- 수강학기 : 2017 봄학기 (6학기)
- 담당교수 : 홍지만 교수님
- 교재
    - (주교재) 리눅스시스템프로그래밍V1.0 (홍지만)
    - (참고교재) Advanced Programming in the Unix Environment (W.Richard Stevens, Stephen A.Rago)
- 개설학부 : 컴퓨터학부
- 이수구분 : 전공선택

# II. 파일 입출력

## 1. open(2)

```c
#include <fcntl.h>
#include <sys/stat.h>
#include <sys/types.h>
int open(const char *pathname, int oflag, … /* mode_t mode */);

// 반환값 : 성공 시 파일 디스크립터, 오류 시 -1 반환하고 errno가 설정됨  
``` 

### open() 필수 예제

[ssu_open.c]
```c
#include <stdio.h>
#include <stdlib.h>
#include <fcntl.h>

int main(void) {
	char *fname = "ssu_test.txt";
	int fd;

	if((fd = open(fname, O_RDONLY)) < 0) {
		fprintf(stderr, "open error for %s\n", fname);
		exit(1);
	}
	else 
		printf("Sucess!\nFilename : %s\nDescripter : %d\n", fname, fd);

	exit(0);
}
``` 

## 2. creat(2)

```c
#include <fcntl.h>
#include <sys/stat.h>
#include <sys/types.h>
int creat(const char *pathname, mode_t mode);

//반환값 : 성공 시 쓰기전용으로 열린 파일 디스크립터, 오류 시 -1을 반환하고 errno가 설정됨
```

### creat() 필수 예제

[ssu_creat.c]
```c
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <fcntl.h>

int main(void) {
	char *fname = "ssu_test.txt";
	int fd;

	if((fd = creat(fname, 0666)) < 0) {
		fprintf(stderr, "creat error for %s\n", fname);
		exit(1);
	}		
	else {
		printf("Success!\nFilename : %s\nDescripter : %d\n", fname, fd);
		close(fd);
	}

	exit(0);
}
```

## 3. close(2)

```c
#include <unistd.h>
int close(int filedes);

//반환값 : 성공 시 0, 오류 시 -1을 반환하고 errno가 설정됨
``` 

## 4. lseek(2)

```c
#include <sys/types.h>
#include <unistd.h>
off_t lseek(int filedes, off_t offset, int whence);

//반환값 : 성공 시 새 파일 오프셋, 오류 시 -1을 반환하고 errno가 설정됨
```
### lseek() 필수 예제

[ssu_lseek.c]
```c
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <fcntl.h>
#include <sys/types.h>

int main(void) {
	char *fname = "ssu_test.txt";
	off_t fsize;
	int fd;

	if((fd = open(fname, O_RDONLY)) < 0) {
		fprintf(stderr, "open error for %s\n", fname);
		exit(1);
	}

	if((fsize = lseek(fd, 0, SEEK_END)) < 0) {
		fprintf(stderr, "lseek error\n");
		exit(1);
	}

	printf("The size of %s is %lu bytes.\n", fname, fsize);
	
	exit(0);
}
``` 

## 5. read(2)

```c
#include <unistd.h>
ssize_t read(int filedes, void *buf, size_t nbytes);

//반환값 : 읽은 바이트 수, 파일이 끝인 경우 0, 오류시 -1을 반환하고 errno가 설정됨
```

## 6. write(2)

```c
#include <unistd.h>
ssize_t write(int filedes, const void *buf, size_t nbytes);

//반환값 : 성공 시 기록된 바이트 수, 오류 시 -1을 반환하고 errno가 설정됨
```

## 7. pread(2), pwrite(2)

```c
#include <unistd.h>
ssize_t pread(int filedes, void *buf, size_t nbytes, off_t offset);

//반환값 : 성공 시 읽은 바이트 수를 반환, 파일 끝(EOF)이면 0을 반환
//요청한 바이트 수보다 작은 값이 반환되더라도 오류가 아님
//오류 발생 시 -1을 반환하며 상응하는 errno가 설정됨
```

```c
#include <unistd.h>
ssize_t pwrite(int filedes, const void *buf, size_t nbytes, off_t offset);

//반환값 : 성공 시 기록된 바이트 수를 반환
//써야 할 바이트 수보다 작은 값을 반환하더라도 오류가 아님
//오류 발생 시 -1을 반환하며 상응하는 errno가 설정됨
``` 

## 8. dup(2), dup2(2)

```c
#include <unistd.h>
int dup(int filedes);
int dup2(int filedes, int filedes2);

//반환값 : 성공 시 새로운 파일 디스크립터 반환, 오류 시 -1을 반환하고 상응하는 errno가 설정됨
```

## 9. fcntl(2)

```c
#include <unistd.h>
#include <fcntl.h>
int fcntl(int filedes, int cmd, … /* int arg */);

//반환값 : 성공 시 설정된 cmd에 따라 다른 값을 반환,
//오류 시 -1을 반환하고 상응하는 errno가 설정됨
``` 

```c
#include <unistd.h>
#include <fcntl.h>
int fcntl(int fd, int cmd, struct flock *lock);

//성공시 설정된 cmd에 따라 다른 값을 반환,
//오류 시 -1을 반환하고 상응하는 errno가 설정됨
```

```c
struct flock {
    short int l_type; /* 잠김 타입 : F_RDLCK, F_WRLCK, or F_UNLCK */
    short int l_whence; /* 파일의 절대적 위치 */
    __off_t l_start; /* 파일의 offset */
    __off_t l_len; /* 잠그고자 하는 파일의 크기 */
    __pid_t l_pid; /* 잠금을 얻은 프로세스의 pid */
};
```

## 10. ioctl(2)

```c
#include <unistd.h> /* System V */
#include <sys/ioctl.h> /* BSD and Linux */
#include <stopts.h> /* XSI STREAMS */

int ioctl(int filedes, int request, …);

//반환값 : 대부분 성공 시 0이나 양수의 값이 반환
//오류 발생 시 -1이 반환되고 상응하는 errno가 설정됨
```

## 11. sync(2), fsync(2), fdatasync(2)

```c
#include <unistd.h>

int fsync(int filedes);
int fdatasync(int filedes);

//반환값 : 성공 시 0을 반환, 오류 발생 시 -1이 반환되고 상응하는 errno가 설정됨

void sync(void);
``` 
